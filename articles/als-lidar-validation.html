<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validating AGB Maps with Airborne LiDAR Data • Plot2Map</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validating AGB Maps with Airborne LiDAR Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Plot2Map</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/plot-data-preparation.html">Plot data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/bias-modeling.html">Bias Modeling and Correction for AGB Maps</a></li>
    <li><a class="dropdown-item" href="../articles/als-lidar-validation.html">Validating AGB Maps with Airborne LiDAR Data</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-uncertainty.html">Advanced Uncertainty Quantification with Spatial Correlation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Validating AGB Maps with Airborne LiDAR Data</h1>
            
      

      <div class="d-none name"><code>als-lidar-validation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Airborne Laser Scanning (ALS), provides high-resolution
three-dimensional measurements of forest structure that can be used to
estimate Above-Ground Biomass (AGB) with remarkable accuracy. Unlike
field plots that provide point measurements, ALS offers wall-to-wall
coverage at fine spatial resolutions (often 20-100m), making it an
excellent reference dataset for validating satellite-derived biomass
maps.</p>
<p>This vignette demonstrates how to use the Plot2Map package to
validate satellite biomass products against ALS-derived AGB estimates.
We’ll use a sample dataset from the Sustainable Landscapes Brazil (SLB)
project, which provides ALS-derived biomass maps at 100m resolution for
a site in the Brazilian Amazon. The workflow includes:</p>
<ul>
<li>Loading ALS data using the <code><a href="../reference/RefLidar.html">RefLidar()</a></code> function</li>
<li>Preparing uncertainty estimates from Coefficient of Variation (CV)
maps</li>
<li>Validating against ESA-CCI Biomass 2018 product</li>
<li>Calculating accuracy metrics and creating visualizations</li>
<li>Interpreting results in the context of tropical forest
monitoring</li>
</ul>
<p>ALS validation is particularly valuable when you need to assess
spatial patterns of map accuracy, validate products at fine resolutions,
or work in regions with limited field plot data. However, field plots
remain essential for calibrating ALS models and quantifying
uncertainties across diverse forest types.</p>
</div>
<div class="section level2">
<h2 id="setup-and-load-required-packages">Setup and Load Required Packages<a class="anchor" aria-label="anchor" href="#setup-and-load-required-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aTnT.github.io/Plot2Map/" class="external-link">Plot2Map</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-slb-als-data">Load SLB ALS Data<a class="anchor" aria-label="anchor" href="#load-slb-als-data"></a>
</h2>
<p>The SLB dataset includes ALS-derived biomass estimates and their
associated uncertainties for a 1,190 hectare area near Manaus, Brazil.
The data were collected in 2018 and processed to 100m grid cells (1
hectare each).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get paths to bundled SLB data</span></span>
<span><span class="va">slb.agb.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_lidar_folder.html">sample_lidar_folder</a></span><span class="op">(</span><span class="st">"SustainableLandscapeBrazil_v04/SLB_AGBmaps"</span><span class="op">)</span></span>
<span><span class="va">slb.cv.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_lidar_folder.html">sample_lidar_folder</a></span><span class="op">(</span><span class="st">"SustainableLandscapeBrazil_v04/SLB_CVmaps"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview available files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">slb.agb.dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">slb.cv.dir</span><span class="op">)</span></span>
<span><span class="co"># [1] "BON_A01_2018_AGB_100m.tif"</span></span>
<span><span class="co"># [1] "BON_A01_2018_CV_100m.tif"</span></span></code></pre></div>
<p>The <code><a href="../reference/RefLidar.html">RefLidar()</a></code> function automatically processes ALS
rasters by:</p>
<ul>
<li>Detecting and reprojecting coordinate systems to WGS84</li>
<li>Extracting plot IDs and years from filenames</li>
<li>Converting raster pixels to a point data frame</li>
<li>Preparing data for Plot2Map validation workflows</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Above-Ground Biomass raster</span></span>
<span><span class="va">agb_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RefLidar.html">RefLidar</a></span><span class="op">(</span></span>
<span>  lidar.dir <span class="op">=</span> <span class="va">slb.agb.dir</span>,</span>
<span>  raster_type <span class="op">=</span> <span class="st">"AGB"</span>,</span>
<span>  allow_interactive <span class="op">=</span> <span class="cn">FALSE</span>  <span class="co"># Non-interactive mode for reproducibility</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview data structure</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total ALS cells:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"AGB range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">$</span><span class="va">AGB</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean AGB:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">$</span><span class="va">AGB</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span><span class="co"># Found 1 raster files for processing</span></span>
<span><span class="co"># Validating coordinate reference systems...</span></span>
<span><span class="co"># Files requiring CRS transformation to EPSG:4326 :</span></span>
<span><span class="co"># BON_A01_2018_AGB_100m.tif </span></span>
<span><span class="co"># Using raster type: AGB </span></span>
<span><span class="co"># Processing raster files with multi-band support...</span></span>
<span><span class="co"># Transforming rasters to target CRS: EPSG:4326 </span></span>
<span><span class="co"># Reprojecting raster with CRS: WGS 84 / UTM zone 19S </span></span>
<span><span class="co"># Calculated average cell size: 0.999803 hectares</span></span>
<span><span class="co"># Attempting automatic pattern detection...</span></span>
<span><span class="co"># Analyzing filename patterns from: BON_A01_2018_AGB_100m </span></span>
<span><span class="co"># Detected Pattern 1: Site_Code_Year_Type format</span></span>
<span><span class="co"># Using automatically detected patterns (confidence: high )</span></span>
<span><span class="co"># Successfully extracted PLOT_ID and YEAR using automatic detection</span></span>
<span><span class="co"># Sample PLOT_ID values: BON </span></span>
<span><span class="co"># Sample YEAR values: 2018 </span></span>
<span></span>
<span><span class="co"># === RefLidar Processing Summary ===</span></span>
<span><span class="co"># Extracted points: 592 </span></span>
<span><span class="co"># Unique plots: 1 </span></span>
<span><span class="co"># Year range: 2018 - 2018 </span></span>
<span><span class="co"># Cell size (ha): 0.999803 </span></span>
<span><span class="co"># CRS transformations: Yes </span></span>
<span><span class="co"># Multi-band processing: No </span></span>
<span><span class="co">#    PLOT_ID   POINT_X   POINT_Y       AGB AVG_YEAR</span></span>
<span><span class="co"># 21     BON -67.28247 -9.859331 0.2824650     2018</span></span>
<span><span class="co"># 54     BON -67.28337 -9.860239 0.1802490     2018</span></span>
<span><span class="co"># 55     BON -67.28247 -9.860239 0.3926857     2018</span></span>
<span><span class="co"># 56     BON -67.28156 -9.860239 0.3369435     2018</span></span>
<span><span class="co"># 87     BON -67.28428 -9.861147 1.4032360     2018</span></span>
<span><span class="co"># 88     BON -67.28337 -9.861147 6.1049371     2018</span></span>
<span><span class="co"># Total ALS cells: 592 </span></span>
<span><span class="co"># AGB range: 0.180249 337.6577 Mg/ha</span></span>
<span><span class="co"># Mean AGB: 187.9 Mg/ha</span></span></code></pre></div>
<p>The Coefficient of Variation (CV) provides a measure of uncertainty
in the ALS-derived biomass estimates. This will be used to weight
observations and calculate total uncertainty.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Coefficient of Variation (uncertainty)</span></span>
<span><span class="va">cv_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RefLidar.html">RefLidar</a></span><span class="op">(</span></span>
<span>  lidar.dir <span class="op">=</span> <span class="va">slb.cv.dir</span>,</span>
<span>  raster_type <span class="op">=</span> <span class="st">"CV"</span>,</span>
<span>  allow_interactive <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview CV values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CV range:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cv_data</span><span class="op">$</span><span class="va">CV</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean CV:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cv_data</span><span class="op">$</span><span class="va">CV</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co"># Found 1 raster files for processing</span></span>
<span><span class="co"># Validating coordinate reference systems...</span></span>
<span><span class="co"># Files requiring CRS transformation to EPSG:4326 :</span></span>
<span><span class="co"># BON_A01_2018_CV_100m.tif </span></span>
<span><span class="co"># Using raster type: CV </span></span>
<span><span class="co"># Processing raster files with multi-band support...</span></span>
<span><span class="co"># Transforming rasters to target CRS: EPSG:4326 </span></span>
<span><span class="co"># Reprojecting raster with CRS: WGS 84 / UTM zone 19S </span></span>
<span><span class="co"># Calculated average cell size: 0.999803 hectares</span></span>
<span><span class="co"># Attempting automatic pattern detection...</span></span>
<span><span class="co"># Analyzing filename patterns from: BON_A01_2018_CV_100m </span></span>
<span><span class="co"># Detected Pattern 1: Site_Code_Year_Type format</span></span>
<span><span class="co"># Using automatically detected patterns (confidence: high )</span></span>
<span><span class="co"># Successfully extracted PLOT_ID and YEAR using automatic detection</span></span>
<span><span class="co"># Sample PLOT_ID values: BON </span></span>
<span><span class="co"># Sample YEAR values: 2018 </span></span>
<span></span>
<span><span class="co"># === RefLidar Processing Summary ===</span></span>
<span><span class="co"># Extracted points: 592 </span></span>
<span><span class="co"># Unique plots: 1 </span></span>
<span><span class="co"># Year range: 2018 - 2018 </span></span>
<span><span class="co"># Cell size (ha): 0.999803 </span></span>
<span><span class="co"># CRS transformations: Yes </span></span>
<span><span class="co"># Multi-band processing: No </span></span>
<span><span class="co"># CV range: 0.284 13.91 </span></span>
<span><span class="co"># Mean CV: 0.711 </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>Now we’ll prepare the ALS data for validation by calculating
uncertainties and adding required metadata fields.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate SD from CV × AGB</span></span>
<span><span class="va">agb_data</span><span class="op">$</span><span class="va">sdTree</span> <span class="op">&lt;-</span> <span class="va">cv_data</span><span class="op">$</span><span class="va">CV</span> <span class="op">*</span> <span class="va">agb_data</span><span class="op">$</span><span class="va">AGB</span></span>
<span></span>
<span><span class="co"># Rename AGB column for Plot2Map compatibility</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"AGB"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"AGB_T_HA"</span></span>
<span></span>
<span><span class="co"># Preview uncertainty</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGB_T_HA"</span>, <span class="st">"sdTree"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#     AGB_T_HA            sdTree       </span></span>
<span><span class="co">#  Min.   :  0.1802   Min.   :  2.507  </span></span>
<span><span class="co">#  1st Qu.:162.4689   1st Qu.: 66.167  </span></span>
<span><span class="co">#  Median :202.5485   Median : 73.826  </span></span>
<span><span class="co">#  Mean   :187.9305   Mean   : 69.534  </span></span>
<span><span class="co">#  3rd Qu.:234.7198   3rd Qu.: 79.624  </span></span>
<span><span class="co">#  Max.   :337.6578   Max.   :106.186  </span></span></code></pre></div>
<p>The <code><a href="../reference/BiomePair.html">BiomePair()</a></code> function assigns ecological zones based
on coordinates, which is necessary for selecting appropriate biomass
models and validation datasets.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign ecological zones using BiomePair()</span></span>
<span><span class="va">agb_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BiomePair.html">BiomePair</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add plot size (100m × 100m = 1 hectare)</span></span>
<span><span class="va">agb_data</span><span class="op">$</span><span class="va">SIZE_HA</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Check assigned zones and years</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">$</span><span class="va">ZONE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">$</span><span class="va">FAO.ecozone</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">agb_data</span><span class="op">$</span><span class="va">AVG_YEAR</span><span class="op">)</span></span>
<span><span class="co"># [1] "S.America"</span></span>
<span><span class="co"># [1] "Tropical rainforest"</span></span>
<span><span class="co"># [1] 2018</span></span></code></pre></div>
<p>The <code><a href="../reference/calculateTotalUncertainty.html">calculateTotalUncertainty()</a></code> function combines
multiple sources of uncertainty:</p>
<ul>
<li>
<code>sdTree</code>: Measurement uncertainty from ALS processing
(from CV values)</li>
<li>
<code>sdSE</code>: Standard error from sampling (spatial
variability)</li>
<li>
<code>varPlot</code>: Total variance used for weighted
aggregation</li>
</ul>
<p>For ALS data at 1 hectare resolution, measurement error typically
dominates over sampling error. Additionally, we need to add an
<code>AGB_T_HA_ORIG</code> column which stores the original
(pre-temporal-adjustment) biomass values. Since our ALS data is already
from 2018 (matching the map year), no temporal adjustment is needed, so
we simply copy the current AGB values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate comprehensive uncertainty (measurement + scale mismatch)</span></span>
<span><span class="va">agb_unc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateTotalUncertainty.html">calculateTotalUncertainty</a></span><span class="op">(</span></span>
<span>  plot_data <span class="op">=</span> <span class="va">agb_data</span>,</span>
<span>  map_year <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  map_resolution <span class="op">=</span> <span class="fl">100</span>  <span class="co"># ESA-CCI resolution in meters</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract processed data with uncertainty</span></span>
<span><span class="va">als_plots</span> <span class="op">&lt;-</span> <span class="va">agb_unc</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span><span class="co"># View uncertainty components</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">agb_unc</span><span class="op">$</span><span class="va">uncertainty_components</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary of total uncertainty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean total uncertainty (SD):"</span>,</span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">als_plots</span><span class="op">$</span><span class="va">sdTotal</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Uncertainty range:"</span>,</span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">als_plots</span><span class="op">$</span><span class="va">sdTotal</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add AGB_T_HA_ORIG column (required by invDasymetry)</span></span>
<span><span class="co"># Since ALS data is already from 2018 (matching map year), no temporal</span></span>
<span><span class="co"># adjustment is needed, so original and current AGB are the same</span></span>
<span><span class="va">als_plots</span><span class="op">$</span><span class="va">AGB_T_HA_ORIG</span> <span class="op">&lt;-</span> <span class="va">als_plots</span><span class="op">$</span><span class="va">AGB_T_HA</span></span>
<span><span class="co"># Using existing sdTree values for tree_level data</span></span>
<span><span class="co"># Calculating sampling uncertainty using Rejou-Mechain approach</span></span>
<span><span class="co"># Loading sampling error data from package file</span></span>
<span><span class="co"># Calculating growth uncertainty by biome</span></span>
<span><span class="co"># Total uncertainty calculated for plot data of type: tree_level</span></span>
<span><span class="co"># measurement    sampling      growth </span></span>
<span><span class="co">#   0.8845427   0.1154573   0.0000000 </span></span>
<span><span class="co"># Mean total uncertainty (SD): 145.9 Mg/ha</span></span>
<span><span class="co"># Uncertainty range: 15.9 3145.2 Mg/ha</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="validation-against-esa-cci-2018">Validation Against ESA-CCI 2018<a class="anchor" aria-label="anchor" href="#validation-against-esa-cci-2018"></a>
</h2>
<p>Now we’ll extract ESA-CCI biomass values at each ALS cell location.
The <code><a href="../reference/invDasymetry.html">invDasymetry()</a></code> function handles:</p>
<ul>
<li>Downloading ESA-CCI tiles (cached after first download)</li>
<li>Applying tree cover thresholds</li>
<li>Extracting map values at reference locations</li>
<li>Calculating validation metrics</li>
</ul>
<p>Note: The first run will download ~600MB of ESA-CCI tiles. Subsequent
runs use cached data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract ESA-CCI 2018 biomass values at ALS locations</span></span>
<span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/invDasymetry.html">invDasymetry</a></span><span class="op">(</span></span>
<span>  plot_data <span class="op">=</span> <span class="va">als_plots</span>,</span>
<span>  clmn <span class="op">=</span> <span class="st">"ZONE"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S.America"</span>,</span>
<span>  aggr <span class="op">=</span> <span class="cn">NULL</span>,              <span class="co"># No aggregation - cell-level validation</span></span>
<span>  threshold <span class="op">=</span> <span class="fl">10</span>,           <span class="co"># 10% tree cover threshold</span></span>
<span>  dataset <span class="op">=</span> <span class="st">"esacci"</span>,</span>
<span>  esacci_biomass_year <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  map_resolution <span class="op">=</span> <span class="fl">0.001</span>,   <span class="co"># ~100m in degrees</span></span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># memfrac   : 0.5</span></span>
<span><span class="co"># tolerance : 0.1</span></span>
<span><span class="co"># verbose   : FALSE</span></span>
<span><span class="co"># todisk    : FALSE</span></span>
<span><span class="co"># tempdir   : /tmp/RtmpwC3fEE</span></span>
<span><span class="co"># datatype  : FLT4S</span></span>
<span><span class="co"># memmin    : 1</span></span>
<span><span class="co"># progress  : 3</span></span>
<span><span class="co"># Filtered 592 plots where ZONE == 'S.America'</span></span>
<span><span class="co"># 592 plots or cells being processed...</span></span>
<span><span class="co"># Processing 592 plots in 1 batches of up to 592 plots each</span></span>
<span><span class="co"># Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="co"># Downloading https://storage.googleapis.com/earthenginepartners-hansen/GFC-2023-v1.11/Hansen_GFC-2023-v1.11_treecover2000_00N_070W.tif to data/GFC/Hansen_GFC-2023-v1.11_treecover2000_00N_070W.tif</span></span>
<span><span class="co"># trying URL 'https://storage.googleapis.com/earthenginepartners-hansen/GFC-2023-v1.11/Hansen_GFC-2023-v1.11_treecover2000_00N_070W.tif'</span></span>
<span><span class="co"># Content type 'application/octet-stream' length 204963567 bytes (195.5 MB)</span></span>
<span><span class="co"># ==================================================</span></span>
<span><span class="co"># downloaded 195.5 MB</span></span>
<span></span>
<span><span class="co"># Successfully downloaded Hansen_GFC-2023-v1.11_treecover2000_00N_070W.tif</span></span>
<span><span class="co"># Processing tile: Hansen_GFC-2023-v1.11_treecover2000_00N_070W.tif</span></span>
<span><span class="co"># Extracting values for ROI...</span></span>
<span><span class="co"># Extraction complete</span></span>
<span><span class="co"># Processing file: N00W070_ESACCI-BIOMASS-L4-AGB-MERGED-100m-2018-fv6.0.tif</span></span>
<span><span class="co"># File not found locally. Attempting to download...</span></span>
<span><span class="co"># Downloading 1 ESA CCI Biomass v6.0 file(s) for year 2018...</span></span>
<span><span class="co">#   |                                                  | 0 % ~calculating </span></span>
<span><span class="co"># (...)</span></span>
<span><span class="co"># Processing tile: Hansen_GFC-2023-v1.11_treecover2000_00N_070W.tif</span></span>
<span><span class="co"># Extracting values for ROI...</span></span>
<span><span class="co"># Extraction complete</span></span>
<span><span class="co"># Processing file: N00W070_ESACCI-BIOMASS-L4-AGB-MERGED-100m-2018-fv6.0.tif</span></span>
<span><span class="co"># File already exists locally</span></span>
<span><span class="co"># Loading raster</span></span>
<span><span class="co"># Extracting values for ROI...</span></span>
<span><span class="co"># Extraction complete</span></span>
<span><span class="co"># AGB values extracted (weighted mean = FALSE): 1 values</span></span>
<span><span class="co"># (...)</span></span>
<span></span>
<span><span class="co"># View validation results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Validation cells after filtering:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">validation</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">validation</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plotAGB_10"</span>, <span class="st">"mapAGB"</span>, <span class="st">"varPlot"</span>, <span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Validation cells after filtering: 592 </span></span>
<span><span class="co">#   plotAGB_10 mapAGB   varPlot         x         y</span></span>
<span><span class="co"># 1   210.6665    248 5362368.6 -67.28882 -9.890197</span></span>
<span><span class="co"># 2   226.1070    226 9892433.9 -67.28791 -9.890197</span></span>
<span><span class="co"># 3   227.4593    240 4637174.9 -67.28882 -9.889289</span></span>
<span><span class="co"># 4   214.9921    257 1040870.6 -67.28973 -9.889289</span></span>
<span><span class="co"># 5   232.2306    273  366678.6 -67.28882 -9.888382</span></span>
<span><span class="co"># 6   175.7104    250  208071.6 -67.28973 -9.888382</span></span></code></pre></div>
<p>The validation data frame contains:</p>
<ul>
<li>
<code>plotAGB_10</code>: ALS biomass after 10% tree cover
filter</li>
<li>
<code>mapAGB</code>: ESA-CCI 2018 biomass at same locations</li>
<li>
<code>varPlot</code>: Uncertainty for weighted aggregation</li>
<li>
<code>x</code>, <code>y</code>: Coordinates</li>
</ul>
<p>The tree cover threshold filters out non-forested areas where biomass
estimates are less reliable. In this case no cell was filtered.</p>
</div>
<div class="section level2">
<h2 id="accuracy-assessment">Accuracy Assessment<a class="anchor" aria-label="anchor" href="#accuracy-assessment"></a>
</h2>
<p>The <code><a href="../reference/Accuracy.html">Accuracy()</a></code> function calculates validation metrics
stratified by AGB bins, which helps identify systematic patterns like
saturation at high biomass values. The function now automatically uses
the <code>varPlot</code> column from your input data (calculated by
<code><a href="../reference/calculateTotalUncertainty.html">calculateTotalUncertainty()</a></code> and preserved by
<code><a href="../reference/invDasymetry.html">invDasymetry()</a></code>) for uncertainty-aware validation. The
varPlot values shown in the output represent the mean variance within
each AGB bin.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate accuracy metrics by AGB bins</span></span>
<span><span class="va">accuracy_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Accuracy.html">Accuracy</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">validation</span>,</span>
<span>  intervals <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"results"</span>,</span>
<span>  str <span class="op">=</span> <span class="st">"slb_vs_esacci2018"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">accuracy_results</span><span class="op">)</span></span>
<span><span class="co"># Using varPlot values from input data for uncertainty-aware validation</span></span>
<span><span class="co">#   AGB bin (Mg/ha)   n AGBref (Mg/ha) AGBmap (Mg/ha) RMSD varPlot</span></span>
<span><span class="co"># 1            0-50  47             14             59   63     319</span></span>
<span><span class="co"># 2          50-100  13             85            188  111    1264</span></span>
<span><span class="co"># 3         100-150  70            127            221   99    6867</span></span>
<span><span class="co"># 4         150-200 150            180            231   56   35229</span></span>
<span><span class="co"># 5         200-250 224            223            237   26  298848</span></span>
<span><span class="co"># 6         250-300  81            265            240   35  137395</span></span>
<span><span class="co"># 7         300-400   7            311            249   66   13537</span></span>
<span><span class="co"># 9           total 592            188            219   55  141828</span></span></code></pre></div>
<p>The <code>varPlot</code> column now shows the actual mean variance
values for each AGB bin, reflecting the uncertainty in your ALS
measurements. Higher varPlot values indicate greater uncertainty in
those biomass ranges.</p>
<p>Let’s extract and interpret the overall metrics:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract overall metrics from accuracy table</span></span>
<span><span class="va">overall</span> <span class="op">&lt;-</span> <span class="va">accuracy_results</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">accuracy_results</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Calculate additional metrics from validation data</span></span>
<span><span class="va">r_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">plotAGB_10</span>, <span class="va">validation</span><span class="op">$</span><span class="va">mapAGB</span>, use <span class="op">=</span> <span class="st">"complete.obs"</span><span class="op">)</span></span>
<span><span class="va">r2_value</span> <span class="op">&lt;-</span> <span class="va">r_value</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">bias_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">mapAGB</span> <span class="op">-</span> <span class="va">validation</span><span class="op">$</span><span class="va">plotAGB_10</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Correlation (R):"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r_value</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"R²:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r2_value</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"RMSE:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">overall</span><span class="op">$</span><span class="va">RMSD</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Bias:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">bias_value</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean ALS AGB:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">overall</span><span class="op">$</span><span class="va">`AGBref (Mg/ha)`</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean ESA-CCI AGB:"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">overall</span><span class="op">$</span><span class="va">`AGBmap (Mg/ha)`</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"Mg/ha\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sample size:"</span>, <span class="va">overall</span><span class="op">$</span><span class="va">n</span>, <span class="st">"cells\n"</span><span class="op">)</span></span>
<span><span class="co"># Correlation (R): 0.754 </span></span>
<span><span class="co"># R²: 0.569 </span></span>
<span><span class="co"># RMSE: 55 Mg/ha</span></span>
<span><span class="co"># Bias: 30.9 Mg/ha</span></span>
<span><span class="co"># Mean ALS AGB: 188 Mg/ha</span></span>
<span><span class="co"># Mean ESA-CCI AGB: 219 Mg/ha</span></span>
<span><span class="co"># Sample size: 592 cells</span></span></code></pre></div>
<p><strong>Interpreting the metrics:</strong></p>
<p>The validation results show <strong>good agreement</strong> between
ALS and ESA-CCI 2018:</p>
<ul>
<li>
<strong>Correlation (R = 0.754)</strong>: Strong linear
relationship, well above the typical 0.5-0.8 range for tropical forests.
This indicates ESA-CCI captures the spatial patterns of biomass
variation observed by ALS.</li>
<li>
<strong>R² = 0.569</strong>: ESA-CCI explains 57% of the variance in
ALS measurements, which is good performance given the different sensor
technologies and resolutions.</li>
<li>
<strong>RMSE = 55 Mg/ha</strong>: The average prediction error is
moderate and within the expected range (60-120 Mg/ha) for tropical
forest validation.</li>
<li>
<strong>Bias = +30.9 Mg/ha</strong>: ESA-CCI systematically
overestimates biomass by ~31 Mg/ha (16% relative to mean ALS AGB of 188
Mg/ha). This positive bias is consistent across the site.</li>
</ul>
<p><strong>Patterns across AGB bins</strong> (from accuracy table):</p>
<ul>
<li>
<strong>Low biomass (0-100 Mg/ha)</strong>: Large overestimation
(ALS: 14-85 Mg/ha, ESA-CCI: 59-188 Mg/ha, RMSD: 63-111 Mg/ha). Likely
due to ground/soil backscatter confusion in radar.</li>
<li>
<strong>Medium biomass (100-250 Mg/ha)</strong>: More consistent
agreement with moderate overestimation (RMSD: 26-99 Mg/ha). This is the
bulk of the data (444 cells).</li>
<li>
<strong>High biomass (250-400 Mg/ha)</strong>: Slight
underestimation at very high biomass (ALS: 265-311 Mg/ha, ESA-CCI:
240-249 Mg/ha), suggesting potential saturation, though sample size is
limited (88 cells).</li>
</ul>
<p><strong>Uncertainty trends</strong>: varPlot increases with AGB (319
at low biomass to 298,848 at medium biomass), reflecting greater
measurement uncertainty in denser forests where ALS penetration is more
challenging.</p>
</div>
<div class="section level2">
<h2 id="visualisations">Visualisations<a class="anchor" aria-label="anchor" href="#visualisations"></a>
</h2>
<p>Visual comparisons help identify systematic patterns and spatial
structure in validation errors.</p>
<div class="section level3">
<h3 id="scatter-plot">Scatter Plot<a class="anchor" aria-label="anchor" href="#scatter-plot"></a>
</h3>
<p>The scatter plot shows individual cell comparisons. Points near the
1:1 line (dashed) indicate good agreement.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create scatter plot comparing ALS vs ESA-CCI</span></span>
<span><span class="fu"><a href="../reference/Scatter.html">Scatter</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">validation</span><span class="op">$</span><span class="va">plotAGB_10</span>,</span>
<span>  y <span class="op">=</span> <span class="va">validation</span><span class="op">$</span><span class="va">mapAGB</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"SLB ALS vs ESA-CCI 2018"</span>,</span>
<span>  fname <span class="op">=</span> <span class="st">"slb_als_scatter.png"</span>,</span>
<span>  outDir <span class="op">=</span> <span class="st">"results"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="slb_als_scatter.png" alt="SLB ALS vs ESA-CCI 2018 Scatter Plot"><div class="figcaption">SLB ALS vs ESA-CCI 2018 Scatter Plot</div>
</div>
</div>
<div class="section level3">
<h3 id="binned-comparison">Binned Comparison<a class="anchor" aria-label="anchor" href="#binned-comparison"></a>
</h3>
<p>The binned plot aggregates observations into AGB bins, showing trends
more clearly than individual points.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create binned comparison plot</span></span>
<span><span class="fu"><a href="../reference/Binned.html">Binned</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">validation</span><span class="op">$</span><span class="va">plotAGB_10</span>,</span>
<span>  y <span class="op">=</span> <span class="va">validation</span><span class="op">$</span><span class="va">mapAGB</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Binned Comparison: ALS vs Satellite"</span>,</span>
<span>  fname <span class="op">=</span> <span class="st">"slb_als_binned.png"</span>,</span>
<span>  outDir <span class="op">=</span> <span class="st">"results"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="slb_als_binned.png" alt="Binned Comparison: ALS vs ESA-CCI 2018"><div class="figcaption">Binned Comparison: ALS vs ESA-CCI 2018</div>
</div>
</div>
<div class="section level3">
<h3 id="spatial-residuals-map">Spatial Residuals Map<a class="anchor" aria-label="anchor" href="#spatial-residuals-map"></a>
</h3>
<p>Spatial visualization of residuals (map - ALS) can reveal geographic
patterns in errors, such as topographic effects or edge artifacts.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate residuals (map - ALS)</span></span>
<span><span class="va">validation</span><span class="op">$</span><span class="va">residual</span> <span class="op">&lt;-</span> <span class="va">validation</span><span class="op">$</span><span class="va">mapAGB</span> <span class="op">-</span> <span class="va">validation</span><span class="op">$</span><span class="va">plotAGB_10</span></span>
<span></span>
<span><span class="co"># Create spatial visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">validation</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">residual</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span></span>
<span>    low <span class="op">=</span> <span class="st">"blue"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    midpoint <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Residual\n(Mg/ha)"</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>, <span class="fl">150</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"ESA-CCI 2018 Residuals vs ALS"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Blue = Underestimate, Red = Overestimate"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="slb_als_residuals_map.png" alt="ESA-CCI 2018 Residuals vs ALS"><div class="figcaption">ESA-CCI 2018 Residuals vs ALS</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="discussion-and-interpretation">Discussion and Interpretation<a class="anchor" aria-label="anchor" href="#discussion-and-interpretation"></a>
</h2>
<p><strong>Our results in context:</strong></p>
<p>The SLB validation shows better-than-typical agreement for tropical
forests:</p>
<ul>
<li>
<strong>Our correlation (R = 0.754)</strong> exceeds the typical
0.6-0.8 range, suggesting the relatively homogeneous Amazon forest at
this site is well-suited for radar-based biomass estimation.</li>
<li>
<strong>Our RMSE (55 Mg/ha)</strong> is at the lower end of the
typical 60-120 Mg/ha range, indicating good overall accuracy.</li>
<li>
<strong>Our bias (+31 Mg/ha)</strong> shows systematic
overestimation rather than the saturation typically seen at high
biomass. The bias is concentrated in low biomass areas, not high biomass
areas.</li>
</ul>
</div>
<div class="section level2">
<h2 id="extensions-and-next-steps">Extensions and Next Steps<a class="anchor" aria-label="anchor" href="#extensions-and-next-steps"></a>
</h2>
<div class="section level3">
<h3 id="bias-modeling">Bias Modeling<a class="anchor" aria-label="anchor" href="#bias-modeling"></a>
</h3>
<p>The validation results can be used to develop bias correction models
that improve satellite map accuracy. The Plot2Map package includes
comprehensive bias modeling functionality demonstrated in the bias
modeling vignette:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"bias-modeling"</span>, package <span class="op">=</span> <span class="st">"Plot2Map"</span><span class="op">)</span></span></code></pre></div>
<p>ALS-derived corrections can improve satellite products by:</p>
<ul>
<li>Reducing systematic bias across AGB ranges</li>
<li>Accounting for regional forest structure differences</li>
<li>Providing spatially continuous training data</li>
</ul>
</div>
<div class="section level3">
<h3 id="custom-als-datasets">Custom ALS Datasets<a class="anchor" aria-label="anchor" href="#custom-als-datasets"></a>
</h3>
<p>This workflow can be applied to your own ALS data. The key
requirements are:</p>
<ul>
<li>Georeferenced raster format (GeoTIFF, etc.)</li>
<li>AGB estimates in Mg/ha</li>
<li>Optional uncertainty maps (CV, SD, or variance)</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example for users with custom ALS data</span></span>
<span><span class="va">custom_als</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RefLidar.html">RefLidar</a></span><span class="op">(</span></span>
<span>  lidar.dir <span class="op">=</span> <span class="st">"path/to/custom/als/"</span>,</span>
<span>  raster_type <span class="op">=</span> <span class="st">"AGB"</span>,</span>
<span>  allow_interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  metadata_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site1_agb.tif"</span>, <span class="st">"site2_agb.tif"</span><span class="op">)</span>,</span>
<span>    plot_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Site1"</span>, <span class="st">"Site2"</span><span class="op">)</span>,</span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2021</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>metadata_map</code> argument allows explicit specification
of plot IDs and years when filenames don’t follow standard naming
conventions.</p>
</div>
<div class="section level3">
<h3 id="related-vignettes">Related Vignettes<a class="anchor" aria-label="anchor" href="#related-vignettes"></a>
</h3>
<p>For more information on Plot2Map workflows:</p>
<ul>
<li>
<strong>Plot data preparation</strong>:
<code><a href="../articles/plot-data-preparation.html">vignette("plot-data-preparation")</a></code> - Field plot data
formatting and RefLidar() usage</li>
<li>
<strong>Advanced uncertainty</strong>:
<code><a href="../articles/advanced-uncertainty.html">vignette("advanced-uncertainty")</a></code> - Spatial uncertainty
quantification methods</li>
<li>
<strong>Bias modeling</strong>:
<code><a href="../articles/bias-modeling.html">vignette("bias-modeling")</a></code> - Full bias correction workflow
from validation to map improvement</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated a complete workflow for validating
satellite biomass maps using high-resolution ALS reference data.
Starting from the bundled SLB dataset, we:</p>
<ol style="list-style-type: decimal">
<li>Loaded ALS-derived AGB and uncertainty maps using
<code><a href="../reference/RefLidar.html">RefLidar()</a></code> (592 cells)</li>
<li>Prepared metadata and calculated total uncertainties (mean: 146
Mg/ha SD)</li>
<li>Validated ESA-CCI 2018 against 592 ALS cells via
<code><a href="../reference/invDasymetry.html">invDasymetry()</a></code>
</li>
<li>Calculated accuracy metrics stratified by AGB bins using
<code><a href="../reference/Accuracy.html">Accuracy()</a></code>
</li>
<li>Created visualizations to identify patterns and spatial
structure</li>
</ol>
<p><strong>Key findings from the SLB validation:</strong></p>
<ul>
<li>
<strong>Strong correlation (R = 0.754, R² = 0.569)</strong> between
ALS and ESA-CCI, exceeding typical performance for tropical forests</li>
<li>
<strong>Moderate RMSE (55 Mg/ha)</strong> at the lower end of
expected range</li>
<li>
<strong>Systematic positive bias (+31 Mg/ha)</strong> indicating
ESA-CCI overestimation, primarily in low biomass areas (0-100
Mg/ha)</li>
<li>
<strong>Uncertainty increases with biomass</strong>, reflecting
greater measurement challenges in dense forests (varPlot from 319 to
298,848 (Mg/ha)²)</li>
</ul>
<p>The <strong>better-than-typical agreement</strong> observed here is
likely due to the relatively homogeneous tropical rainforest at the SLB
site and good temporal matching (both 2018). The cell-level validation
approach (592 validation points) provides rich spatial information that
can guide bias correction, identify problematic regions, and improve
future biomass mapping efforts.</p>
<p>This workflow is readily adaptable to any ALS dataset with
appropriate formatting, making it a valuable tool for researchers
validating biomass products across diverse forest ecosystems. The
combination of fine-scale spatial coverage (100m cells) and quantified
uncertainties makes ALS an excellent complement to traditional field
plot validation.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/arnanaraza" class="external-link">Arnan Araza</a>, <a href="https://github.com/aTnT" class="external-link">André Tavares</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
