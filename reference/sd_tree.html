<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate AGB and standard deviations from tree-level data — sd_tree • Plot2Map</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate AGB and standard deviations from tree-level data — sd_tree"><meta name="description" content="This function calculates plot-level Above Ground Biomass (AGB) and Standard Deviation using tree-level data and plot locations.
It uses the BIOMASS package for AGB calculation and standard deviation estimation. The function automatically detects
common column name variations and applies taxonomic correction using BIOMASS::correctTaxo."><meta property="og:description" content="This function calculates plot-level Above Ground Biomass (AGB) and Standard Deviation using tree-level data and plot locations.
It uses the BIOMASS package for AGB calculation and standard deviation estimation. The function automatically detects
common column name variations and applies taxonomic correction using BIOMASS::correctTaxo."><meta property="og:image" content="https://atnt.github.io/Plot2Map/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Plot2Map</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/plot-data-preparation.html">Plot data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/bias-modeling.html">Bias Modeling and Correction for AGB Maps</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-uncertainty.html">Advanced Uncertainty Quantification with Spatial Correlation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate AGB and standard deviations from tree-level data</h1>

      <div class="d-none name"><code>sd_tree.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calculates plot-level Above Ground Biomass (AGB) and Standard Deviation using tree-level data and plot locations.
It uses the BIOMASS package for AGB calculation and standard deviation estimation. The function automatically detects
common column name variations and applies taxonomic correction using BIOMASS::correctTaxo.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sd_tree</span><span class="op">(</span><span class="va">plot</span>, <span class="va">xy</span>, region <span class="op">=</span> <span class="st">"World"</span>, max_retries <span class="op">=</span> <span class="fl">3</span>, retry_delay <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>A data frame containing tree-level data. The function automatically detects column names with flexible patterns:</p><dl><dt>ID column</dt>
<dd><p>Detects: id, ID, code, CODE, plot, PLOT, plot_id, PLOT_ID, plotId, PlotId</p></dd>

<dt>Diameter column</dt>
<dd><p>Detects: diameter, dbh, DBH, D_idtree, d_idtree, dbh_allo, DBH_allo, diam, d, D</p></dd>

<dt>Genus column</dt>
<dd><p>Detects: Genus_accepted, genus_accepted (preferred), genus, Genus, GENUS</p></dd>

<dt>Species column</dt>
<dd><p>Detects: Species_accepted, species_accepted (preferred), species, Species, SPECIES, sp, SP</p></dd>

<dt>Height column (optional)</dt>
<dd><p>Detects: height, HEIGHT, H, h, h95, H95, HC, hc, tree_height, TREE_HEIGHT</p></dd>


</dl></dd>


<dt id="arg-xy">xy<a class="anchor" aria-label="anchor" href="#arg-xy"></a></dt>
<dd><p>A data frame containing plot location data. The function automatically detects column names:</p><dl><dt>ID column</dt>
<dd><p>Detects: id, ID, code, CODE, plot, PLOT, plot_id, PLOT_ID, plotId, PlotId</p></dd>

<dt>X coordinate</dt>
<dd><p>Detects: x, X, xutmr, XUTMR, utm_x, UTM_X, longitude, LONGITUDE, long, lon</p></dd>

<dt>Y coordinate</dt>
<dd><p>Detects: y, Y, yutmr, YUTMR, utm_y, UTM_Y, latitude, LATITUDE, lat</p></dd>

<dt>size</dt>
<dd><p>Plot size in square meters (numeric).</p></dd>

<dt>year</dt>
<dd><p>Year of measurement or survey (numeric).</p></dd>


</dl></dd>


<dt id="arg-region">region<a class="anchor" aria-label="anchor" href="#arg-region"></a></dt>
<dd><p>Region (or vector of region) of interest of your sample. By default, Region is
set to 'World', but you can restrict the WD estimates to a single region :</p><ul><li><p><code>AfricaExtraTrop</code>: Africa (extra tropical)</p></li>
<li><p><code>AfricaTrop</code>: Africa (tropical)</p></li>
<li><p><code>Australia</code>: Australia</p></li>
<li><p><code>AustraliaTrop</code>: Australia (tropical)</p></li>
<li><p><code>CentralAmericaTrop</code>: Central America (tropical)</p></li>
<li><p><code>China</code>: China</p></li>
<li><p><code>Europe</code>: Europe</p></li>
<li><p><code>India</code>: India</p></li>
<li><p><code>Madagascar</code>: Madagascar</p></li>
<li><p><code>Mexico</code>: Mexico</p></li>
<li><p><code>NorthAmerica</code>: North America</p></li>
<li><p><code>Oceania</code>: Oceania</p></li>
<li><p><code>SouthEastAsia</code>: South-East Asia</p></li>
<li><p><code>SouthEastAsiaTrop</code>: South-East Asia (tropical)</p></li>
<li><p><code>SouthAmericaExtraTrop</code>: South America (extra tropical)</p></li>
<li><p><code>SouthAmericaTrop</code>: South America (tropical)</p></li>
<li><p><code>World</code>: World</p></li>
</ul></dd>


<dt id="arg-max-retries">max_retries<a class="anchor" aria-label="anchor" href="#arg-max-retries"></a></dt>
<dd><p>Maximum number of retry attempts for taxonomic correction API calls (default: 3).</p></dd>


<dt id="arg-retry-delay">retry_delay<a class="anchor" aria-label="anchor" href="#arg-retry-delay"></a></dt>
<dd><p>Initial delay in seconds between retry attempts, with exponential backoff (default: 1).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with plot-level AGB estimates and standard deviations, including columns:</p><dl><dt>PLOT_ID</dt>
<dd><p>Unique identifier for each plot.</p></dd>

<dt>POINT_X</dt>
<dd><p>X-coordinate of the plot location.</p></dd>

<dt>POINT_Y</dt>
<dd><p>Y-coordinate of the plot location.</p></dd>

<dt>SIZE_HA</dt>
<dd><p>Plot size in hectares.</p></dd>

<dt>AVG_YEAR</dt>
<dd><p>Average year of measurement across trees in the plot.</p></dd>

<dt>AGB_T_HA</dt>
<dd><p>Above Ground Biomass scaled to tons per hectare.</p></dd>

<dt>sdTree</dt>
<dd><p>Standard deviation of AGB within the plot.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps:</p><ol><li><p>Flexible column dDetection: automatically detects and maps column name variations to standard names.
The function provides information about which columns are being used.</p></li>
<li><p>Taxonomic correction: applies BIOMASS::correctTaxo() to standardize genus and species names,
with preference for accepted taxonomic names (e.g., Genus_accepted over genus).
Uses a retry mechanism to handle temporary API failures/delays.</p></li>
<li><p>Filters trees with diameter &gt;= 10cm.</p></li>
<li><p>Retrieves wood density data using corrected taxonomy.</p></li>
<li><p>Computes or uses provided tree height data. When height data is missing and the brms
package is unavailable, automatically detects Feldpausch regions using coordinates
and BIOMASS::computeFeldRegion() for height-diameter relationships.</p></li>
<li><p>Runs Monte Carlo simulation for AGB estimation.</p></li>
<li><p>Calculates plot-level AGB and standard deviation.</p></li>
<li><p>Scales values per hectare.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="column-name-flexibility">Column Name Flexibility<a class="anchor" aria-label="anchor" href="#column-name-flexibility"></a></h2>


<p>This function resolves GitHub issue #6 by providing robust column name detection.
It handles common variations found in real-world datasets, including:</p><ul><li><p>Research databases with standardized column names (e.g., D_idtree, xutmr/yutmr)</p></li>
<li><p>Field data with simple column names (e.g., dbh, x/y)</p></li>
<li><p>Taxonomically corrected data with accepted names (e.g., Genus_accepted/Species_accepted)</p></li>
<li><p>Various coordinate systems (UTM, lat/lon, etc.)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Feldpausch, T.R., et al. (2012). <em>Tree height integrated into pantropical forest biomass estimates.</em>
Biogeosciences, 9, 3381–3403.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">plotsTree</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="sample_file.html">sample_file</a></span><span class="op">(</span><span class="st">"SampleTree.csv"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plotsTree</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     id      genus    species  diameter  size                 fez      gez year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 BSP1 Terminalia  bellirica  3.501409 10000 tropical rainforest tropical 1996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 BSP1   Ziziphus   oenoplia  3.819719 10000 tropical rainforest tropical 1996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 BSP1    Aporosa lindleyana 16.870424 10000 tropical rainforest tropical 1996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 BSP1      Ixora  brachiata  4.138029 10000 tropical rainforest tropical 1996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 BSP1   Wrightia    arborea  5.411268 10000 tropical rainforest tropical 1996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 BSP1      Ixora  brachiata  3.183099 10000 tropical rainforest tropical 1996</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xyTree</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="sample_file.html">sample_file</a></span><span class="op">(</span><span class="st">"SampleTreeXY.csv"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xyTree</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     id        y        x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 BSP1 14.36806 74.91944</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 BSP1 14.36806 74.91944</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 BSP1 14.36806 74.91944</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 BSP1 14.36806 74.91944</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 BSP1 14.36806 74.91944</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 BSP1 14.36806 74.91944</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">plot_uncertainties</span> <span class="op">&lt;-</span> <span class="fu">sd_tree</span><span class="op">(</span><span class="va">plotsTree</span>, <span class="va">xyTree</span>, region <span class="op">=</span> <span class="st">"India"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using useCache=TRUE is recommended to reduce online search time for the next query</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There seem to be a problem reaching the TNRS API!</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Failed to perform HTTP request.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Taxonomic correction attempt 1 failed: Invalid taxonomic correction results (empty or length mismatch). Retrying in 1 seconds...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using useCache=TRUE is recommended to reduce online search time for the next query</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There seem to be a problem reaching the TNRS API!</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Failed to perform HTTP request.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Taxonomic correction attempt 2 failed: Invalid taxonomic correction results (empty or length mismatch). Retrying in 1 seconds...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using useCache=TRUE is recommended to reduce online search time for the next query</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There seem to be a problem reaching the TNRS API!</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Failed to perform HTTP request.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Taxonomic correction failed after 3 attempts: Invalid taxonomic correction results (empty or length mismatch). Using original taxonomic names.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Taxonomic correction failed after all retry attempts. Using original taxonomic names.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>DRYAD data only stored 289 wood density values in your region of interest. You could provide additional wood densities (parameter addWoodDensityData) or widen your region (region="World")</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The reference dataset contains 289 wood density values</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Your taxonomic table contains 340 taxa</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No tree height data found in original plot data. Calculating height using BIOMASS height-diameter model.</span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plot_uncertainties</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   PLOT_ID  POINT_X  POINT_Y SIZE_HA AVG_YEAR  AGB_T_HA    sdTree</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    BSP1 74.91944 14.36806       1     1996 158.03745  9.839335</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   BSP10 74.69861 14.94722       1     1996 417.99472 22.585124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  BSP100 75.82000 13.54722       1     1996  41.25254  3.934893</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  BSP101 75.43444 13.72639       1     1996 348.63751 38.003134</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  BSP102 74.88833 13.92361       1     1996 516.82368 39.705160</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  BSP104 74.90917 13.87000       1     1996 700.53039 74.854013</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/arnanaraza" class="external-link">Arnan Araza</a>, <a href="https://github.com/aTnT" class="external-link">André Tavares</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

