<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Predict bias wall-to-wall across study region — predictBiasMap • Plot2Map</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predict bias wall-to-wall across study region — predictBiasMap"><meta name="description" content="This function applies a trained bias model to generate wall-to-wall predictions
of systematic bias across the study region. The predicted bias can then be used
to adjust the original AGB map."><meta property="og:description" content="This function applies a trained bias model to generate wall-to-wall predictions
of systematic bias across the study region. The predicted bias can then be used
to adjust the original AGB map."><meta property="og:image" content="https://atnt.github.io/Plot2Map/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Plot2Map</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/plot-data-preparation.html">Plot data preparation</a></li>
    <li><a class="dropdown-item" href="../articles/bias-modeling.html">Bias Modeling and Correction for AGB Maps</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-uncertainty.html">Advanced Uncertainty Quantification with Spatial Correlation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Predict bias wall-to-wall across study region</h1>

      <div class="d-none name"><code>predictBiasMap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function applies a trained bias model to generate wall-to-wall predictions
of systematic bias across the study region. The predicted bias can then be used
to adjust the original AGB map.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">predictBiasMap</span><span class="op">(</span></span>
<span>  <span class="va">bias_model</span>,</span>
<span>  <span class="va">covariate_stack</span>,</span>
<span>  filename <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return_raster <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-bias-model">bias_model<a class="anchor" aria-label="anchor" href="#arg-bias-model"></a></dt>
<dd><p>Trained model object from <code><a href="trainBiasModel.html">trainBiasModel</a></code>.
Must be a list containing at minimum a 'model' component (ranger or randomForest
object) and a 'predictors' component (character vector of predictor names).</p></dd>


<dt id="arg-covariate-stack">covariate_stack<a class="anchor" aria-label="anchor" href="#arg-covariate-stack"></a></dt>
<dd><p>SpatRaster object containing all predictor layers used
in model training. Layer names must match the predictor names used in
<code>bias_model$predictors</code>. Typically includes: map AGB, map SD, height,
biome, tree cover, slope, aspect, and IFL.</p></dd>


<dt id="arg-filename">filename<a class="anchor" aria-label="anchor" href="#arg-filename"></a></dt>
<dd><p>Optional character string specifying output file path for the
predicted bias raster. If provided, the raster will be written to disk.
If NULL (default), the raster is kept in memory. For large regions, providing
a filename is recommended to avoid memory issues.</p></dd>


<dt id="arg-return-raster">return_raster<a class="anchor" aria-label="anchor" href="#arg-return-raster"></a></dt>
<dd><p>Logical indicating whether to return the SpatRaster object.
Default is TRUE. If FALSE and filename is provided, only the file path is
returned.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">terra::writeRaster</a></code>, such as
overwrite, datatype, gdal options, etc.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>return_raster = TRUE</code>, returns a SpatRaster object with predicted
bias values in Mg/ha. Positive values indicate areas where the map overestimates
AGB compared to expected values based on covariates. Negative values indicate
areas where the map underestimates AGB. If <code>return_raster = FALSE</code> and
<code>filename</code> is provided, returns the file path as a character string.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function uses <code><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">terra::predict</a></code> to apply the trained Random Forest
model to a raster stack of covariates. The function automatically handles both
ranger and randomForest model objects.</p>
<p>The covariate stack must have layer names that exactly match the predictor
variable names used during model training. Use <code>names(covariate_stack)</code>
to check layer names and <code>names(covariate_stack) &lt;- c(...)</code> to rename
if needed.</p>
<p>For large regions or high-resolution rasters, it is recommended to:</p><ul><li><p>Provide a filename to write directly to disk</p></li>
<li><p>Use appropriate datatype (e.g., datatype = "FLT4S" for 4-byte floats)</p></li>
<li><p>Consider tiling options via GDAL options</p></li>
</ul><p>The predicted bias map will have:</p><ul><li><p>Same extent, resolution, and CRS as the input covariate_stack</p></li>
<li><p>NA values where any covariate has NA</p></li>
<li><p>Values typically ranging from -100 to +100 Mg/ha for most forests</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Araza, A., et al. (2022). A comprehensive framework for assessing the accuracy
and uncertainty of global above-ground biomass maps. Remote Sensing of Environment,
272, 112917. https://doi.org/10.1016/j.rse.2022.112917</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="trainBiasModel.html">trainBiasModel</a></code> for training the bias model,
<code><a href="adjustMapBias.html">adjustMapBias</a></code> for applying the predicted bias to adjust the AGB map,
<code><a href="extractBiasCovariates.html">extractBiasCovariates</a></code> for the initial data preparation</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Following from trainBiasModel example</span></span></span>
<span class="r-in"><span><span class="co"># Assuming bias_model is already created</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create covariate stack matching model predictors</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">100</span>, nrow <span class="op">=</span> <span class="fl">100</span>, xmin <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, xmax <span class="op">=</span> <span class="fl">10</span>, ymin <span class="op">=</span> <span class="fl">35</span>, ymax <span class="op">=</span> <span class="fl">45</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sd_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">height_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">treecover_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stack covariates with correct names</span></span></span>
<span class="r-in"><span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">map_layer</span>, <span class="va">sd_layer</span>, <span class="va">height_layer</span>, <span class="va">treecover_layer</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"sd"</span>, <span class="st">"height"</span>, <span class="st">"treecover"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Predict bias across region</span></span></span>
<span class="r-in"><span><span class="va">bias_map</span> <span class="op">&lt;-</span> <span class="fu">predictBiasMap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  bias_model <span class="op">=</span> <span class="va">bias_model</span>,</span></span>
<span class="r-in"><span>  covariate_stack <span class="op">=</span> <span class="va">covs</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bias_map</span>, main <span class="op">=</span> <span class="st">"Predicted Bias (Mg/ha)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save to file</span></span></span>
<span class="r-in"><span><span class="va">bias_map</span> <span class="op">&lt;-</span> <span class="fu">predictBiasMap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  bias_model <span class="op">=</span> <span class="va">bias_model</span>,</span></span>
<span class="r-in"><span>  covariate_stack <span class="op">=</span> <span class="va">covs</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"predicted_bias.tif"</span>,</span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/arnanaraza" class="external-link">Arnan Araza</a>, <a href="https://github.com/aTnT" class="external-link">André Tavares</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

