<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Above Ground Biomass Plot to Map Comparison • Plot2Map</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Above Ground Biomass Plot to Map Comparison">
<meta name="description" content="Plot2Map is a workflow for automating aboveground biomass plot to map comparison. It filters deforested plots, adjusts plot biomass temporally to align with map years, corrects for forest fraction at support units, and compares adjusted plots with biomass maps. The package handles various support units and incorporates growth increment data for temporal adjustments.">
<meta property="og:description" content="Plot2Map is a workflow for automating aboveground biomass plot to map comparison. It filters deforested plots, adjusts plot biomass temporally to align with map years, corrects for forest fraction at support units, and compares adjusted plots with biomass maps. The package handles various support units and incorporates growth increment data for temporal adjustments.">
<meta property="og:image" content="https://atnt.github.io/Plot2Map/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">Plot2Map</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="articles/plot-data-preparation.html">Plot data preparation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="plot2map-">Plot2Map <a class="anchor" aria-label="anchor" href="#plot2map-"></a>
</h1>
</div>
<p>Plot2Map is an R package for comparing forest plot data to biomass maps, with a focus on Above Ground Biomass (AGB) estimation and validation.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install Plot2Map from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"aTnT/Plot2Map"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="what-plot2map-can-be-used-for">What Plot2Map can be used for<a class="anchor" aria-label="anchor" href="#what-plot2map-can-be-used-for"></a>
</h2>
<ul>
<li>Pre-processing various types of plot data (point data, polygons, tree-level measurements, lidar)</li>
<li>Temporal adjustment of plot data to match map epoch</li>
<li>Estimation of measurement and sampling errors</li>
<li>Validation of global AGB maps</li>
<li>Support for custom forest masks</li>
<li>Aggregation of results at different spatial scales</li>
</ul>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="plot-data-pre-processing">Plot data pre-processing<a class="anchor" aria-label="anchor" href="#plot-data-pre-processing"></a>
</h3>
<p>Here’s a basic workflow using Plot2Map. Let’s start by creating a sample dataset of 10 plots.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aTnT.github.io/Plot2Map/" class="external-link">Plot2Map</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">sampled_plots</span> <span class="op">&lt;-</span> <span class="va">plots</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sampled_plots</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#      PLOT_ID     POINT_X   POINT_Y  AGB_T_HA AVG_YEAR SIZE_HA</span></span>
<span><span class="co"># 2369     EU2   1.3059145  42.59214  87.87177     2001   0.196</span></span>
<span><span class="co"># 5273     EU2  -0.1585048  42.63245 150.97321     2004   0.196</span></span>
<span><span class="co"># 1252     EU2  -1.0662342  39.61600  58.63558     2006   0.196</span></span>
<span><span class="co"># 356      EU2  -5.1210978  40.02713  37.31206     2004   0.196</span></span>
<span><span class="co"># 7700     EU1  15.2187262  59.81792  67.79700     2008   0.015</span></span>
<span><span class="co"># 3954     EU2  -7.1823899  37.34714  94.59592     2007   0.196</span></span>
<span><span class="co"># 5403     EU2  -7.2162433  37.34765  45.56841     2007   0.196</span></span>
<span><span class="co"># 932      EU2  -2.7070556  42.68534  55.14102     2003   0.196</span></span>
<span><span class="co"># 5637    AUS1 145.8683679 -20.69546  53.69000     2004   0.160</span></span>
<span><span class="co"># 4002     EU2  -3.9889352  40.33963  46.49786     2000   0.196</span></span></code></pre></div>
<p>We now preprocess the sampled plot data. The first step is to remove plots that have been deforested based on the Global Forest Change (GFC) dataset (Hansen et al., 2013). We use <code><a href="reference/Deforested.html">Deforested()</a></code> that processes each plot, downloads the necessary GFC forest loss tiles, and determines if the plot has been deforested beyond a set deforestation threshold or if the deforestation occurred before or during the specified map year. In the example below we use the default 5% deforestation threshold, and assume a map year of 2023:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Deforested.html">Deforested</a></span><span class="op">(</span><span class="va">sampled_plots</span>,  map_year <span class="op">=</span> <span class="fl">2023</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sampled_plots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># $non_deforested_plots</span></span>
<span><span class="co"># Simple feature collection with 9 features and 4 fields</span></span>
<span><span class="co"># Geometry type: POINT</span></span>
<span><span class="co"># Dimension:     XY</span></span>
<span><span class="co"># Bounding box:  xmin: -7.216243 ymin: -20.69546 xmax: 145.8684 ymax: 59.81792</span></span>
<span><span class="co"># Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#   PLOT_ID  AGB_T_HA AVG_YEAR SIZE_HA                    geometry</span></span>
<span><span class="co"># 1     EU2  87.87177     2001   0.196   POINT (1.305915 42.59214)</span></span>
<span><span class="co"># 2     EU2 150.97321     2004   0.196 POINT (-0.1585048 42.63245)</span></span>
<span><span class="co"># 3     EU2  58.63558     2006   0.196    POINT (-1.066234 39.616)</span></span>
<span><span class="co"># 4     EU2  37.31206     2004   0.196  POINT (-5.121098 40.02713)</span></span>
<span><span class="co"># 5     EU1  67.79700     2008   0.015   POINT (15.21873 59.81792)</span></span>
<span><span class="co"># 6     EU2  45.56841     2007   0.196  POINT (-7.216243 37.34765)</span></span>
<span><span class="co"># 7     EU2  55.14102     2003   0.196  POINT (-2.707056 42.68534)</span></span>
<span><span class="co"># 8    AUS1  53.69000     2004   0.160  POINT (145.8684 -20.69546)</span></span>
<span><span class="co"># 9     EU2  46.49786     2000   0.196  POINT (-3.988935 40.33963)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $all_plots</span></span>
<span><span class="co"># Simple feature collection with 10 features and 6 fields</span></span>
<span><span class="co"># Geometry type: POINT</span></span>
<span><span class="co"># Dimension:     XY</span></span>
<span><span class="co"># Bounding box:  xmin: -7.216243 ymin: -20.69546 xmax: 145.8684 ymax: 59.81792</span></span>
<span><span class="co"># Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#      PLOT_ID  AGB_T_HA AVG_YEAR SIZE_HA                    geometry defo defo_start_year</span></span>
<span><span class="co"># 2369     EU2  87.87177     2001   0.196   POINT (1.305915 42.59214)    0              NA</span></span>
<span><span class="co"># 5273     EU2 150.97321     2004   0.196 POINT (-0.1585048 42.63245)    0              NA</span></span>
<span><span class="co"># 1252     EU2  58.63558     2006   0.196    POINT (-1.066234 39.616)    0              NA</span></span>
<span><span class="co"># 356      EU2  37.31206     2004   0.196  POINT (-5.121098 40.02713)    0              NA</span></span>
<span><span class="co"># 7700     EU1  67.79700     2008   0.015   POINT (15.21873 59.81792)    0              NA</span></span>
<span><span class="co"># 3954     EU2  94.59592     2007   0.196   POINT (-7.18239 37.34714)    1            2021</span></span>
<span><span class="co"># 5403     EU2  45.56841     2007   0.196  POINT (-7.216243 37.34765)    0              NA</span></span>
<span><span class="co"># 932      EU2  55.14102     2003   0.196  POINT (-2.707056 42.68534)    0              NA</span></span>
<span><span class="co"># 5637    AUS1  53.69000     2004   0.160  POINT (145.8684 -20.69546)    0              NA</span></span>
<span><span class="co"># 4002     EU2  46.49786     2000   0.196  POINT (-3.988935 40.33963)    0              NA</span></span></code></pre></div>
<p>We can see that the function returns a list containing two elements:</p>
<ul>
<li><p><code>$non_deforested_plots</code>: A <code>sf</code> object with non-deforested plots.</p></li>
<li><p><code>$all_plots</code>: The original input <code>sf</code> object with added deforestated proportion (0-1) w.r.t. to plot area and deforestation start year.</p></li>
</ul>
<p>In the next step we assign ecological zones and continents to plot locations. We use <code><a href="reference/BiomePair.html">BiomePair()</a></code> for this. This function overlays plot locations with pre-processed data to assign corresponding FAO ecological zones (biomes), Global Ecological Zones (GEZ) and continents (zones) to each plot:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/BiomePair.html">BiomePair</a></span><span class="op">(</span><span class="va">sampled_plots</span><span class="op">$</span><span class="va">non_deforested_plots</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sampled_plots</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#   PLOT_ID  AGB_T_HA AVG_YEAR SIZE_HA     POINT_X   POINT_Y      ZONE                 FAO.ecozone         GEZ</span></span>
<span><span class="co"># 1    AUS1  53.69000     2004   0.160 145.8683679 -20.69546 Australia          Tropical shrubland    Tropical</span></span>
<span><span class="co"># 2     EU1  67.79700     2008   0.015  15.2187262  59.81792    Europe    Boreal coniferous forest      Boreal</span></span>
<span><span class="co"># 3     EU2  87.87177     2001   0.196   1.3059145  42.59214    Europe   Temperate mountain system   Temperate</span></span>
<span><span class="co"># 4     EU2  45.56841     2007   0.196  -7.2162433  37.34765    Europe      Subtropical dry forest Subtropical</span></span>
<span><span class="co"># 5     EU2  58.63558     2006   0.196  -1.0662342  39.61600    Europe      Subtropical dry forest Subtropical</span></span>
<span><span class="co"># 6     EU2  37.31206     2004   0.196  -5.1210978  40.02713    Europe      Subtropical dry forest Subtropical</span></span>
<span><span class="co"># 7     EU2  46.49786     2000   0.196  -3.9889352  40.33963    Europe      Subtropical dry forest Subtropical</span></span>
<span><span class="co"># 8     EU2 150.97321     2004   0.196  -0.1585048  42.63245    Europe   Temperate mountain system   Temperate</span></span>
<span><span class="co"># 9     EU2  55.14102     2003   0.196  -2.7070556  42.68534    Europe Subtropical mountain system Subtropical</span></span></code></pre></div>
<p>In the step below we use <code><a href="reference/TempApplyVar.html">TempApplyVar()</a></code> to adjust plot biomass values to align with the map year by adding or subtracting annual growth increment to older or newer plots. The function uses growth data from a model-based estimate of growth-age relationships. The function also computes the temporal variance (standard deviation) of biomass changes based on growth-rate standard deviations. In the example below we apply temporal adjustment and calculate variance to all Global Ecological Zones (GEZ) within the plot data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/TempApplyVar.html">TempApplyVar</a></span><span class="op">(</span><span class="va">sampled_plots</span>, <span class="fl">2023</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sampled_plots</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#   PLOT_ID  AGB_T_HA AVG_YEAR SIZE_HA     POINT_X   POINT_Y      ZONE                 FAO.ecozone         GEZ AGB_T_HA_ORIG sdGrowth</span></span>
<span><span class="co"># 1    AUS1 129.69000     2004   0.160 145.8683679 -20.69546 Australia          Tropical shrubland    Tropical      53.69000     76.0</span></span>
<span><span class="co"># 2     EU1  84.29700     2008   0.015  15.2187262  59.81792    Europe    Boreal coniferous forest      Boreal      67.79700     16.5</span></span>
<span><span class="co"># 3     EU2  87.87177     2001   0.196   1.3059145  42.59214    Europe   Temperate mountain system   Temperate      87.87177      0.0</span></span>
<span><span class="co"># 4     EU2 109.56841     2007   0.196  -7.2162433  37.34765    Europe      Subtropical dry forest Subtropical      45.56841     64.0</span></span>
<span><span class="co"># 5     EU2 126.63558     2006   0.196  -1.0662342  39.61600    Europe      Subtropical dry forest Subtropical      58.63558     68.0</span></span>
<span><span class="co"># 6     EU2 113.31206     2004   0.196  -5.1210978  40.02713    Europe      Subtropical dry forest Subtropical      37.31206     76.0</span></span>
<span><span class="co"># 7     EU2 138.49786     2000   0.196  -3.9889352  40.33963    Europe      Subtropical dry forest Subtropical      46.49786     92.0</span></span>
<span><span class="co"># 8     EU2 150.97321     2004   0.196  -0.1585048  42.63245    Europe   Temperate mountain system   Temperate     150.97321      0.0</span></span>
<span><span class="co"># 9     EU2 105.14102     2003   0.196  -2.7070556  42.68534    Europe Subtropical mountain system Subtropical      55.14102     50.0</span></span></code></pre></div>
<p>Note how the <code>$AGB_T_HA</code>, <code>$AGB_T_HA_ORIG</code> and <code>$sdGrowth</code> columns are added to the plot dataset. The first corresponding to the adjusted biomass values for the specified <code>map_year</code>, the second keeping the original biomass values before adjustment and the last adding the temporal standard deviation of the biomass adjustment.</p>
</div>
<div class="section level3">
<h3 id="agb-map-validation">AGB map validation<a class="anchor" aria-label="anchor" href="#agb-map-validation"></a>
</h3>
<p>Now let’s suppose we want to validate an AGB map on the <code>sampled_plots</code> data above. We give an example of doing this with the <code><a href="reference/invDasymetry.html">invDasymetry()</a></code> function where the AGB map is the <a href="https://dx.doi.org/10.5285/bf535053562141c6bb7ad831f5998d77" class="external-link">ESA-CCI AGB dataset</a>.</p>
<p>This function performs inverse dasymetric mapping on plot data. It selects plots based on given criteria, optionally aggregates them, and calculates forest fraction and AGB for each plot or cell:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate AGB map</span></span>
<span><span class="va">AGBdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invDasymetry.html">invDasymetry</a></span><span class="op">(</span>plot_data <span class="op">=</span> <span class="va">sampled_plots</span>,</span>
<span>                       clmn <span class="op">=</span> <span class="st">"ZONE"</span>,</span>
<span>                       value <span class="op">=</span> <span class="st">"Europe"</span>,</span>
<span>                       dataset <span class="op">=</span> <span class="st">"esacci"</span>,</span>
<span>                       is_poly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       threshold <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 8 plots being processed...</span></span>
<span><span class="co">#   |                                                                                                       |   0%ℹ Loading Plot2Map</span></span>
<span><span class="co">#   |=============                                                                                          |  12%1 tiles to download/check.</span></span>
<span><span class="co"># 0 file(s) succeeded, 1 file(s) skipped, 0 file(s) failed.</span></span>
<span><span class="co"># Processing tile: Hansen_GFC-2023-v1.11_treecover2000_60N_010E.tif</span></span>
<span><span class="co"># Extracting values for ROI...</span></span>
<span><span class="co"># Extraction complete</span></span>
<span><span class="co"># Processing file: N60E010_ESACCI-BIOMASS-L4-AGB-MERGED-100m-2021-fv5.0.tif</span></span>
<span><span class="co"># File not found locally. Attempting to download...</span></span>
<span><span class="co"># Downloading 1 ESA CCI Biomass v5.01 file(s) for year 2021...</span></span>
<span><span class="co">#   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=12s  </span></span>
<span><span class="co"># Download successful: N60E010_ESACCI-BIOMASS-L4-AGB-MERGED-100m-2021-fv5.0.tif</span></span>
<span><span class="co"># Loading raster</span></span>
<span><span class="co"># Extracting values for ROI...</span></span>
<span><span class="co"># Extraction complete</span></span>
<span><span class="co"># AGB values extracted (weighted mean = FALSE): 1 values</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># (...)</span></span>
<span><span class="co">#                       </span></span>
<span><span class="co"># Processing complete. Results: </span></span>
<span><span class="co"># </span></span>
<span><span class="co">#          plotAGB_10 tfPlotAGB orgPlotAGB mapAGB SIZE_HA          x        y</span></span>
<span><span class="co"># result.1   21.07425  84.29700   67.79700      0   0.015 15.2187262 59.81792</span></span>
<span><span class="co"># result.2   87.87177  87.87177   87.87177     87   0.196  1.3059145 42.59214</span></span>
<span><span class="co"># result.3  109.56841 109.56841   45.56841     47   0.196 -7.2162433 37.34765</span></span>
<span><span class="co"># result.4  110.80614 126.63558   58.63558     11   0.196 -1.0662342 39.61600</span></span>
<span><span class="co"># result.5    0.00000 113.31206   37.31206      7   0.196 -5.1210978 40.02713</span></span>
<span><span class="co"># result.6  138.49786 138.49786   46.49786      1   0.196 -3.9889352 40.33963</span></span>
<span><span class="co"># result.7    0.00000 150.97321  150.97321     72   0.196 -0.1585048 42.63245</span></span>
<span><span class="co"># result.8  105.14102 105.14102   55.14102     89   0.196 -2.7070556 42.68534                   </span></span></code></pre></div>
<p>Now that we have the validation data from <code><a href="reference/invDasymetry.html">invDasymetry()</a></code>, we can analyze and visualize the results. The function returns a data frame with several columns, including:</p>
<ul>
<li>
<code>plotAGB_[threshold]</code>: AGB values adjusted for forest cover threshold (e.g., plotAGB_10)</li>
<li>
<code>tfPlotAGB</code>: Tree-filtered plot AGB (only when not aggregated)</li>
<li>
<code>orgPlotAGB</code>: Original plot AGB values</li>
<li>
<code>mapAGB</code>: The AGB values extracted from the map</li>
<li>
<code>SIZE_HA</code>: Plot size in hectares</li>
<li>
<code>x</code> and <code>y</code>: Plot coordinates</li>
</ul>
<p>We can now visualize the relationship between the reference plot data and map values using the plotting functions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create output directory for results</span></span>
<span><span class="va">out_dir</span> <span class="op">&lt;-</span> <span class="st">"results"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize results with binned plot</span></span>
<span><span class="fu"><a href="reference/Binned.html">Binned</a></span><span class="op">(</span><span class="va">AGBdata</span><span class="op">$</span><span class="va">plotAGB_10</span>, <span class="va">AGBdata</span><span class="op">$</span><span class="va">mapAGB</span>, </span>
<span>       <span class="st">"Europe - Binned Comparison"</span>, </span>
<span>       <span class="st">"binned_Europe.png"</span>, </span>
<span>       outDir <span class="op">=</span> <span class="va">out_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a scatter plot</span></span>
<span><span class="fu"><a href="reference/Scatter.html">Scatter</a></span><span class="op">(</span><span class="va">AGBdata</span><span class="op">$</span><span class="va">plotAGB_10</span>, <span class="va">AGBdata</span><span class="op">$</span><span class="va">mapAGB</span>, </span>
<span>        <span class="st">"Europe - Scatter Plot"</span>, </span>
<span>        <span class="st">"scatter_Europe.png"</span>, </span>
<span>        outDir <span class="op">=</span> <span class="va">out_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate accuracy metrics</span></span>
<span><span class="co"># Use fewer intervals since we have a small sample</span></span>
<span><span class="va">accuracy_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Accuracy.html">Accuracy</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">AGBdata</span>, intervals <span class="op">=</span> <span class="fl">6</span>, dir <span class="op">=</span> <span class="va">out_dir</span>, str <span class="op">=</span> <span class="st">"Europe"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">accuracy_results</span><span class="op">)</span></span>
<span><span class="co">#    AGB bin (Mg/ha)  n AGBref (Mg/ha) AGBmap (Mg/ha) RMSD varPlot</span></span>
<span><span class="co"># 1            0-100  4             27             42   38       1</span></span>
<span><span class="co"># 2          100-150  4            116             37   91       1</span></span>
<span><span class="co"># 19           total 24             72             39   70       1</span></span></code></pre></div>
<p>The output of the <code><a href="reference/Accuracy.html">Accuracy()</a></code> function provides a comprehensive assessment of map accuracy, including:</p>
<ul>
<li>Binned statistics by AGB ranges</li>
<li>Mean Square Deviation (MSD)</li>
<li>Plot variance</li>
<li>Map variance</li>
<li>Overall statistics like RMSE, bias, and R²</li>
</ul>
</div>
<div class="section level3">
<h3 id="handling-uncertainty">Handling Uncertainty<a class="anchor" aria-label="anchor" href="#handling-uncertainty"></a>
</h3>
<p>Plot2Map also provides tools for calculating and incorporating uncertainty in your analyses. The <code><a href="reference/calculateTotalUncertainty.html">calculateTotalUncertainty()</a></code> function combines measurement, sampling, and growth uncertainties:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate total uncertainty</span></span>
<span><span class="va">uncertainty_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculateTotalUncertainty.html">calculateTotalUncertainty</a></span><span class="op">(</span><span class="va">sampled_plots</span>, </span>
<span>                                               map_year <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>                                               map_resolution <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co"># Calculating tree measurement uncertainty using RF model</span></span>
<span><span class="co"># Calculating sampling uncertainty using Rejou-Mechain approach</span></span>
<span><span class="co"># Using existing growth uncertainty (sdGrowth) values</span></span>
<span><span class="co"># Total uncertainty calculated for plot data of type: point                                               </span></span>
<span></span>
<span><span class="co"># Print the uncertainty components</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">uncertainty_results</span><span class="op">$</span><span class="va">uncertainty_components</span><span class="op">)</span></span>
<span><span class="co"># measurement    sampling      growth </span></span>
<span><span class="co">#   0.2323145   0.2530749   0.5146106 </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="working-with-different-plot-types">Working with Different Plot Types<a class="anchor" aria-label="anchor" href="#working-with-different-plot-types"></a>
</h3>
<p>Plot2Map can handle various types of plot data:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Point data with AGB estimates</strong>:
<ul>
<li>Pre-formatted (see documentation)</li>
<li>Unformatted (can be processed with <code><a href="reference/RawPlots.html">RawPlots()</a></code>)</li>
</ul>
</li>
<li>
<strong>Polygon data with corner coordinates</strong>:
<ul>
<li>Can be processed with <code><a href="reference/Polygonize.html">Polygonize()</a></code>
</li>
</ul>
</li>
<li>
<strong>Tree-level measurement data</strong>:
<ul>
<li>Processed with <code>MeasurementErr()</code> which estimates AGB and uncertainty</li>
</ul>
</li>
<li>
<strong>Nested plot data (with sub-plots)</strong>:
<ul>
<li>Processed with <code><a href="reference/Nested.html">Nested()</a></code> followed by <code>MeasurementErr()</code>
</li>
</ul>
</li>
<li>
<strong>Lidar-based reference maps</strong>:
<ul>
<li>Processed with <code><a href="reference/RefLidar.html">RefLidar()</a></code>
</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="aggregated-analysis-and-spatial-correlation">Aggregated Analysis and Spatial Correlation<a class="anchor" aria-label="anchor" href="#aggregated-analysis-and-spatial-correlation"></a>
</h3>
<p>Plot2Map allows for spatial aggregation of plots into larger cells for analysis at different scales:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregated analysis at 0.1 degree resolution with minimum 3 plots per cell</span></span>
<span><span class="va">AGBdata_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invDasymetry.html">invDasymetry</a></span><span class="op">(</span>plot_data <span class="op">=</span> <span class="va">sampled_plots</span>,</span>
<span>                           clmn <span class="op">=</span> <span class="st">"ZONE"</span>, </span>
<span>                           value <span class="op">=</span> <span class="st">"Europe"</span>,</span>
<span>                           aggr <span class="op">=</span> <span class="fl">0.1</span>,         <span class="co"># 0.1 degree aggregation</span></span>
<span>                           minPlots <span class="op">=</span> <span class="fl">3</span>,       <span class="co"># Minimum 3 plots per cell</span></span>
<span>                           dataset <span class="op">=</span> <span class="st">"esacci"</span>,</span>
<span>                           is_poly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize aggregated results</span></span>
<span><span class="fu"><a href="reference/Binned.html">Binned</a></span><span class="op">(</span><span class="va">AGBdata_agg</span><span class="op">$</span><span class="va">plotAGB_10</span>, <span class="va">AGBdata_agg</span><span class="op">$</span><span class="va">mapAGB</span>, </span>
<span>      <span class="st">"Europe - Aggregated"</span>, </span>
<span>      <span class="st">"binned_agg_Europe.png"</span>,</span>
<span>      outDir <span class="op">=</span> <span class="va">out_dir</span><span class="op">)</span></span></code></pre></div>
<p>For spatial correlation analysis, you can use:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate spatial correlation parameters</span></span>
<span><span class="va">spatcor_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/SpatCor.html">SpatCor</a></span><span class="op">(</span><span class="va">AGBdata</span>, distance_km <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spatcor_results</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="complete-workflow-example">Complete Workflow Example<a class="anchor" aria-label="anchor" href="#complete-workflow-example"></a>
</h3>
<p>Here’s a complete workflow example combining all the key steps:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aTnT.github.io/Plot2Map/" class="external-link">Plot2Map</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and preprocess plot data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select plots from a specific region</span></span>
<span><span class="va">europe_plots</span> <span class="op">&lt;-</span> <span class="va">plots</span><span class="op">[</span><span class="va">plots</span><span class="op">$</span><span class="va">ZONE</span> <span class="op">==</span> <span class="st">"Europe"</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Remove deforested plots</span></span>
<span><span class="va">non_deforested</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Deforested.html">Deforested</a></span><span class="op">(</span><span class="va">europe_plots</span>, map_year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span><span class="op">$</span><span class="va">non_deforested_plots</span></span>
<span></span>
<span><span class="co"># Add ecological zone information</span></span>
<span><span class="va">eco_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/BiomePair.html">BiomePair</a></span><span class="op">(</span><span class="va">non_deforested</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate total uncertainty including all components</span></span>
<span><span class="va">plots_with_uncertainty</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculateTotalUncertainty.html">calculateTotalUncertainty</a></span><span class="op">(</span></span>
<span>  <span class="va">eco_plots</span>, </span>
<span>  map_year <span class="op">=</span> <span class="fl">2020</span>, </span>
<span>  map_resolution <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Validate against ESA-CCI biomass map</span></span>
<span><span class="va">validation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invDasymetry.html">invDasymetry</a></span><span class="op">(</span></span>
<span>  plot_data <span class="op">=</span> <span class="va">plots_with_uncertainty</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  clmn <span class="op">=</span> <span class="st">"GEZ"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"Temperate"</span>, </span>
<span>  dataset <span class="op">=</span> <span class="st">"esacci"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create output directory</span></span>
<span><span class="va">results_dir</span> <span class="op">&lt;-</span> <span class="st">"validation_results"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">results_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize results</span></span>
<span><span class="fu"><a href="reference/Binned.html">Binned</a></span><span class="op">(</span><span class="va">validation_results</span><span class="op">$</span><span class="va">plotAGB_10</span>, <span class="va">validation_results</span><span class="op">$</span><span class="va">mapAGB</span>,</span>
<span>      <span class="st">"Temperate Zone Validation"</span>, </span>
<span>      <span class="st">"temperate_validation.png"</span>,</span>
<span>      outDir <span class="op">=</span> <span class="va">results_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate accuracy metrics</span></span>
<span><span class="va">accuracy_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Accuracy.html">Accuracy</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">validation_results</span>, intervals <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                          dir <span class="op">=</span> <span class="va">results_dir</span>, </span>
<span>                          str <span class="op">=</span> <span class="st">"temperate_2020"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print summary statistics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">accuracy_stats</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="vignettes">Vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a>
</h2>
<ul>
<li>Plot data preparation</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Araza et al., A comprehensive framework for assessing the accuracy and uncertainty of global above-ground biomass maps, Remote Sensing of Environment, Volume 272, 2022, 112917, ISSN 0034-4257, <a href="https://doi.org/10.1016/j.rse.2022.112917" class="external-link uri">https://doi.org/10.1016/j.rse.2022.112917</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing Plot2Map</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/arnanaraza" class="external-link">Arnan Araza</a> <br><small class="roles"> Author </small>   </li>
<li>
<a href="https://github.com/aTnT" class="external-link">André Tavares</a> <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/arnanaraza" class="external-link">Arnan Araza</a>, <a href="https://github.com/aTnT" class="external-link">André Tavares</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
